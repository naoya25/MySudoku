# MVVM ä»•æ§˜æ›¸ â€“ MySudokuï¼ˆãƒŠãƒ³ãƒ—ãƒ¬ iOS ã‚¢ãƒ—ãƒªï¼‰

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ **ã‚¯ãƒ©ã‚·ãƒƒã‚¯ MVVM**ï¼ˆModel / View / ViewModel ã‚’ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«åˆ†å‰²ï¼‰ã‚’æ¡ç”¨ã—ãŸå®Ÿè£…æŒ‡é‡ã§ã™ã€‚SwiftUI æœªçµŒé¨“ã®é–‹ç™ºè€…ã§ã‚‚è¿·ã‚ãšã«å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è²¬å‹™ã‚’æ•´ç†ã—ã¦ã„ã¾ã™ã€‚

---

## 1. ã‚´ãƒ¼ãƒ« & å‰æ

* **SwiftÂ 5.10 / iOSÂ 18 SDK / SwiftUI** ä½¿ç”¨ã€‚
* ç›¤é¢ãƒ­ã‚¸ãƒƒã‚¯ãƒ»UIãƒ»çŠ¶æ…‹ç®¡ç†ã‚’ **MVVM ã® 3 ãƒ¬ã‚¤ãƒ¤ãƒ¼**ã«åˆ†é›¢ã—ã€**ç–çµåˆ**ã¨**ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**ã‚’é«˜ã‚ã‚‹ã€‚
* ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå•é¡Œç”Ÿæˆãƒ»æ¤œè¨¼ï¼‰ã¯ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã«ã‚ˆã‚Šå“è³ªä¿è¨¼ã€‚

---

## 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆä¾‹ï¼‰

```text
./MySudoku/
MySudoku/
â”œâ”€ MySudokuApp.swift          # @main ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”œâ”€ Assets.xcassets/           # ã‚¢ã‚»ãƒƒãƒˆ
â”œâ”€ Model/                     # ãƒ¢ãƒ‡ãƒ«
â”‚  â””â”€ Home/
â”œâ”€ View/                      # ãƒ“ãƒ¥ãƒ¼
â”‚  â””â”€ Home/
â”‚      â””â”€ HomeView.swift
â”œâ”€ ViewModel/                 # ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ‡ãƒ«
â”‚  â””â”€ Home/
â”‚      â””â”€ HomeViewModel.swift
â””â”€ Preview Content/
    â””â”€ Preview Assets.xcassets/
```

> **ãƒã‚¤ãƒ³ãƒˆ**
>
> * `Model`, `View`, `ViewModel` ã‚’ **ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§æ˜ç¢ºã«åˆ†é›¢**ã€‚
> * å„ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…ã‚’ **æ©Ÿèƒ½ï¼ˆHome ãªã©ï¼‰ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€** ã§ã¾ã¨ã‚ã€å°†æ¥æ©Ÿèƒ½è¿½åŠ æ™‚ã«æ‹¡å¼µã—ã‚„ã™ã„æ§‹æˆã€‚
> * ã‚¢ã‚»ãƒƒãƒˆã¯ `Assets.xcassets`ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å°‚ç”¨ã¯ `Preview Content/` ã«åˆ†é›¢ã—ã¦ç®¡ç†ã€‚
> * å¿…è¦ã«å¿œã˜ã¦ `Services/` ã‚„ `Resources/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¾Œã‹ã‚‰è¿½åŠ ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‹¡å¤§ã«åˆã‚ã›ã¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–å¯èƒ½ã€‚

---

## 3. CodingÂ Guidelines

| é …ç›®         | è¦ç´„                                                               |
| ------------ | ------------------------------------------------------------------ |
| å‘½å         | UpperCamelCaseï¼ˆå‹ï¼‰, lowerCamelCaseï¼ˆå¤‰æ•°/é–¢æ•°ï¼‰                  |
| ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ | å¯èƒ½ãªé™ã‚Š `internal` â†’ `private` / `fileprivate` ã«çµã‚‹           |
| ä¾å­˜æ³¨å…¥     | ViewModel ã« Service ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿/Environment ã§æ³¨å…¥ |
| éåŒæœŸå‡¦ç†   | `async/await` + `@MainActor`ã€‚Combine ã¯è£œåŠ©çš„ã«ä½¿ç”¨               |
| UI ãƒ¬ã‚¤ãƒ¤    | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒãŸãšã€çŠ¶æ…‹ã¯ ViewModel ã¸å§”è­² (`@StateObject`) |
| ãƒ†ã‚¹ãƒˆ       | `XCTest`ã€‚Model & Services ã¯ 90%+ ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç›®æ¨™                |

---

## 4. ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã®è²¬å‹™

### 4.1 Model

* **ç´”ç²‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ** (`Board`, `Cell`, `Move`) ã¨ **ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯**ï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ç”Ÿæˆï¼‰ã€‚
* Swift Package åŒ–ã™ã‚Œã° iPadOS/macOS ã§ã‚‚å†åˆ©ç”¨å¯ã€‚

### 4.2 ViewModel

* View ã‹ã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’å—ã‘ã€Model/Service ã¸ä¼é”ã€‚
* `@Published` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ View ã¸çŠ¶æ…‹ã‚’å…¬é–‹ã€‚
* ä¾‹: `GameBoardViewModel` ã« `selectCell(_:)`, `enterNumber(_:)`, `toggleNoteMode()`ã€‚

### 4.3 View

* `GameBoardView` ãªã© SwiftUI æ§‹æˆè¦ç´ ã€‚`@StateObject var vm: GameBoardViewModel` ã‚’ä¿æŒã€‚
* ã™ã¹ã¦ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯ ViewModel ã«å§”è­²ã—ã€UI ã¯å®£è¨€çš„ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ã¿ã€‚

---

## 5. å…±é€šã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦

| Service                | å½¹å‰²                                                                            |
| ---------------------- | ------------------------------------------------------------------------------- |
| **TimerService**       | çµŒéç§’ã‚’ `AsyncStream` + `@Published` ã§é…ä¿¡ã—ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ pause/resume |
| **ValidationService**  | è¡Œãƒ»åˆ—ãƒ»ãƒ–ãƒ­ãƒƒã‚¯ã®é‡è¤‡åˆ¤å®šã¨ã‚¨ãƒ©ãƒ¼åº§æ¨™è¿”å´                                      |
| **UndoStack**          | `push`, `undo`, `redo`ã€‚ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹ã§ä»»æ„ã® `Move` ã‚’æ‰±ã†                    |
| **PersistenceService** | SwiftData ã§ãƒ—ãƒ¬ã‚¤é€”ä¸­ï¼æˆ¦ç¸¾ã‚’ä¿å­˜                                              |
| **ThemeService**       | ãƒ€ãƒ¼ã‚¯ / ãƒ©ã‚¤ãƒˆã€ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ åˆ‡æ›¿ã‚’ç®¡ç†                                       |

---

## 6. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ä¾‹

```swift
struct Cell: Identifiable, Codable {
    let id: UUID = UUID()
    var value: Int?          // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å€¤
    var given: Int?          // ã‚ã‚‰ã‹ã˜ã‚åŸ‹ã‚ã‚‰ã‚ŒãŸæ•°å­—
    var pencilMarks: Set<Int> = []
}

struct Board: Codable {
    var cells: [Cell]        // 81 ãƒã‚¹
    var startDate: Date      // ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚åˆ»
    var moves: [Move] = []   // Undo/Redo ç”¨
}

struct Move: Codable {
    let cellID: UUID
    let previousValue: Int?
    let newValue: Int?
    let previousMarks: Set<Int>
    let newMarks: Set<Int>
}
```

---

## 7. ãƒ“ãƒ«ãƒ‰æ‰‹é † & TODO

1. **Xcode ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ** â†’ ä¸Šè¨˜ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç‰©ç†ãƒ•ã‚©ãƒ«ãƒ€ã¨ã—ã¦è¿½åŠ ã€‚
2. `Model/GameBoard` ã« `Board`, `Cell`, `Move` ã¨ **ValidationService** ã‚’å®Ÿè£…ã€‚
3. `ViewModel/GameBoard` ã§ `GameBoardViewModel` ã‚’ä½œã‚Šã€æ•°å­—å…¥åŠ› & ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’ç®¡ç†ã€‚
4. `View/GameBoard` ã« UI ã‚’å®Ÿè£…ã—ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å‹•ä½œç¢ºèªã€‚
5. `Services/TimerService` ã¨ `UndoStack` ã‚’çµ±åˆã€‚
6. `PersistenceService` ã§é€”ä¸­ä¿å­˜ï¼†å¾©å…ƒã‚’ç¢ºèªã€‚
7. `Model/Generator` ã‚’ Swift Package ã¨ã—ã¦å®Ÿè£…ã—ã€ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã§é›£æ˜“åº¦åˆ¥ç”Ÿæˆã‚’æ¤œè¨¼ã€‚
8. UI ä»•ä¸Šã’ & ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œã€‚

---

> ğŸš€ **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: `Model/GameBoard` ã¨ `ViewModel/GameBoard` ã‚’ã¾ãšå®Ÿè£…ã—ã€`View/GameBoard` ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æ•°å­—å…¥åŠ›ãƒ»ãƒ¡ãƒ¢æ©Ÿèƒ½ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
